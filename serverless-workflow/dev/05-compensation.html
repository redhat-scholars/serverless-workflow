<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Compensation :: Serverless Workflow Tutorial</title>
    <link rel="canonical" href="https://redhat-scholars.github.io/serverless-workflow/serverless-workflow/dev/05-compensation.html">
    <link rel="prev" href="04-longrunning.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-scholars.github.io/serverless-workflow">Serverless Workflow Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="serverless-workflow" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisite tools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#vscode-extensions">Visual Studio Code Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#base-image">Pull the serverless data index image</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#project-start">Clone and build the startup project</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-startup-project.html">2. Startup Project</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-startup-project.html#structure">The project structure</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-startup-project.html#run">Run the workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-startup-project.html#inspect">Inspect the workflow</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-startup-project.html#monitor">Monitor the runtime</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-inventory.html">3. Inventory Logic</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-inventory.html#usecase">The use case</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-inventory.html#inventory">The Inventory Sprint</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-inventory.html#test">Test the workflow logic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-inventory.html#call-rest">Call an external REST service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-inventory.html#test-rest">Test the external REST service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-longrunning.html">4. Long Running Workflows</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-longrunning.html#waitevent">Wait an event</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-longrunning.html#eventing">Eventing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-longrunning.html#test-events">Test the events</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="05-compensation.html">5. Compensation</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Serverless Workflow Tutorial</a></li>
    <li><a href="05-compensation.html">5. Compensation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/redhat-scholars/serverless-workflow/edit/dev/documentation/modules/ROOT/pages/05-compensation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Compensation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Sometimes the unexpected happens</strong>: for example, a customer changes his mind and wants to cancel an order or the stock are running low. Actually, in real world: <em>the change is the only constant!</em></p>
</div>
<div class="paragraph">
<p>Workflow developers start defining the <em>happy path</em>, then they have to deal with unexpected results (out of stock, order cancellation events, etc). A workflow could define a long chain of activities and under certain conditions, it might be necessary to define an exit strategy: warning all parties involved that they <strong>must undo</strong> what has been done before.</p>
</div>
<div class="paragraph">
<p>When you have <em>short running transactions</em> (during milliseconds), you could put in place a traditional <strong>atomic transaction strategy</strong>, but this option has also many drawbacks which make it really unpopular for distributed computing systems, especially when they run in a cloud context.</p>
</div>
<div class="paragraph">
<p>When you deal with <em>long running transactions</em>, as known as <em>business transactions</em>, that spans of over minutes, hours or days, one can only try to revert what was previously done, this could have consequences: for example, Hotels usually applies a cancellation fee when the cancellation is too near to the reservation day.</p>
</div>
<div class="paragraph">
<p>A workflow might involve multiple logical steps, there are conditional paths that depends on specific instance data. When the business logic requires a cancellation of the workflow instance, you need to reverse the flow of actions, undoing what was previously done.</p>
</div>
<div class="paragraph">
<p>In the workflow nomenclature, this capability is called <strong>Compensation</strong>, whereas in the microservices architecture this is also known as <a href="https://microservices.io/patterns/data/saga.html:">Saga Pattern</a>.</p>
</div>
<div class="paragraph">
<p>The good news is that the Serverless Workflow engine helps you in this difficult situations! In fact, the workflow developer can define for each action a <strong>compensation action</strong> that will only be invoked if necessary. Behind the scenes, the workflow engine, when an action is completed, records the corresponding compensation action in a stack. If the workflow subsequently encounters conditions that require compensation, only then does <strong>the engine retrace</strong> the stack of compensation activities to close everything correctly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cancellingevent"><a class="anchor" href="#cancellingevent"></a>Cancelling event</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In our use case, we have to deal with situations where customers have to cancel their orders. Specifically, if the cancellation event arrives before the shipping one, it is necessary to call for compensation: the concrete compensation action depends on the previous execution path, if the item was available, the compensation action will call the internal shipping department otherwise the compensation action will deal with the external supplier.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="04-longrunning.html">4. Long Running Workflows</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
