= Startup project
include::_attributes.adoc[]

This section shows how to create a simple Serverless Workflow using https://start.kubesmarts.org/[Serverless Logic Web Tools].

[#basic-workflow]
== A basic workflow

. Open the https://start.kubesmarts.org/[Serverless Logic Web Tools] in your browser.

. Select `YAML` button in the *Create* pane 
image:02_webtool.png[alt]

. *Change* the workflow name with `order`
image:02_new_swf.png[alt]

. *Click* the text `Create a Serverless Workflow` and select `Serverless Workflow Example`: a simple template is generated.

The workflow editor is split in two panes: the _text_ editor and the _visual_ representation of the workflow.

At the moment there is no way to graphically edit the workflow, the user can edit the _yaml_ file on the left side and see the diagram changes on the right.
When the user clicks on a node of the graph, the cursor in the text editor is moved to the corresponding section of the _yaml_ definition.

*Change* the template to match the following:

[.console-input]
[source, yaml,subs="+macros,+attributes"]
----
id: order
version: "1.0"
specVersion: "0.8"
name: Order Workflow
description: Order Workflow Sample
start: Order Received
functions:
  - name: printMessage
    type: custom
    operation: sysout
states:
  - name: Order Received
    type: operation
    actions:
      - name: printAction
        functionRef:
          refName: printMessage
          arguments:
            message: '"Order received: " + .orderId'
    end: true
----

Let's analyze the content:

* At the beginning there are some identification details: the unique `id`, `version`, `name`, `description` and the `specVersion`.
* The `start` attribute point to the first state in the flow `Order Received`.
* `functions` are a set of reusable definitions for service invocations or expression evaluation. In this example, *printMessage* is a custom function which print a message in the log.
* `states` contains a set of states which are the building block of the workflow logic.

The workflow logic is pretty straightforward: when the workflow starts the `Order Received` state is executed then it ends. However, there are some other aspects:

* The workflow is started with an input message that is copied in the internal workflow state.
* The `Order Received` state invokes the `printMessage` function: it's worth noticing that `.orderId` is a https://jqlang.github.io/jq/manual[*jq* expression] to read the workflow state. In other word, it expect to find `orderId` in the workflow state.

To learn more about Serverless Workflow notation and semantic don't hesitate to read the official specification document which is really clear and accessible: https://github.com/serverlessworkflow/specification/blob/0.8.x/specification.md[]

[#run]
== Run the workflow

You can easily run your first workflow in your OpenShift environment:

. Locate the `Try on OpenShift` button at the top right of the page and *select* it.

. *Select* `Setup...`
+
image:02_try_openshift.png[try openshift]

. In the *OpenShift* setting page select `Add connection` button

. Fill in the OpenShift connection details:

.. *Namespace (project)*: Use the namespace provided by the proctor (if you are running this tutorial on your own, create a new namespace and use it)

.. To retrieve the values for *Host* and *Token*:

... *Open* the OpenShift console in a different browser window.

... In the top right corner *select* the _username_ and the `Copy login command` entry.
+
image:02_oc_command.png[oc command]

... After the login process, *select* `Dysplay token` link to get a command line that resemble the following:
+
[.console-output]
[source,bash,subs="+macros,+attributes"]
----
oc login --token=sha256~VPMhRtYqHghxlRLWD5X92lg3ZIxr0V7dYYcP5DWxJq4 --server=https://api.ocp4.dmshift.eu:6443
----

... *Copy* the string after `--token` into the _Token_ field in the other browser window.

... Likewise, *copy* the string after `--server` into the _Host_ field in the other browser window.

... Finally, *select* the `Connect` button, you should see the following confirmation message:
+
image:02_connection_ok.png[connection ok]

Now that the OpenShift connection is up, you need to reopen the workflow:

. Go back on the main page *clicking* on the top banner:
+
image:02_home.png[home]

. From the left navigation menu *select* `Recent Models`.

. *Select* `order` to open again the workflow designer.

. *Select* again `Try on OpenShift` button and then `Upload "*order*" to Dev Mode`.
+
image:02_upload.png[upload]

. Wait for the confirmation message and *select* `Go to Serverless Workflow Dev UI â†—` to open the _Dev UI_ in a new browser tab.
+
image:02_devui.png[Dev UI]

From *Dev UI* you can trigger a new workflow instance and inspect its execution:

. *Select* `Workflow Definitions`

. *Click* on the arrow button in corresponding to the `order` row.
+
image:02_wf-def.png[Workflow definitions]

. *Fill* in the `Start Workflow Data` edit box with the following JSON payload:
+
[.console-input]
[source, json,subs="+macros,+attributes"]
----
{"orderId":"order-123"}
----

. *Select* the `Start` button below.

You should get a confirmation message stating that your _workflow instance was triggered_.

*CONGRATULATION!!!* Your first Serverless Workflow was executed as expected!


[#inspect]
== Inspect the workflow execution

To inspect the workflow execution just triggered *select* `Go to workflow list` at the bottom of the confirmation message.

image:02_started.png[Workflow definitions]

In the _Workflow Instances_ page, *select* the first instance in the list:

image:02_wf_list.png[Workflow list]

In this _Workflow Details_ page, you can inspect all the details of the workflow execution from the following boxes:

- Diagram: the serverless workflow diagram is shown, with completed nodes colored green.
- Timeline: the main workflow tasks, listed in order of execution.
- Details: the workflow instance metadata.
- Variables: the internal state of the workflow instance.

Finally, have a look at the **Monitoring** page charts on your own!